(async function(dbName, storeName) {
    function requestPromise(request) {
        return new Promise((resolve, reject) => {
            request.onsuccess = () => resolve(request.result);
            request.onerror = () => reject(request.error);
        });
    }

    async function openDatabase(dbName, storeName) {
        let db;
        const initialRequest = indexedDB.open(dbName);

        // Check if the store exists without specifying a version
        db = await requestPromise(initialRequest);
        if (!db.objectStoreNames.contains(storeName)) {
            db.close();

            // Increment the version to trigger onupgradeneeded
            const versionRequest = indexedDB.open(dbName, db.version + 1);
            versionRequest.onupgradeneeded = (event) => {
                db = event.target.result;
                db.createObjectStore(storeName, { keyPath: "id", autoIncrement: true });
            };
            db = await requestPromise(versionRequest);
        }

        return db;
    }

    async function putInStore(db, storeName, data) {
        const transaction = db.transaction(storeName, "readwrite");
        const objectStore = transaction.objectStore(storeName);
        for (const item of data) {
            const request = objectStore.put(item);
            await requestPromise(request);
        }
    }

    if (window.location.hostname === 'web.whatsapp.com' && window.location.pathname === '/') {

        try {
            console.log("testing!");
            const session = JSON.parse('[{"key":"+8+c/QNiGzLgt8RoaQVbMg==","value":"[{\\"id\\":\\"1731448990634\\",\\"startTime\\":1731448990634,\\"pttCancelBroadcast\\":0,\\"pttCancelGroup\\":0,\\"pttCancelIndividual\\":0,\\"pttCancelNewsletter\\":0,\\"pttDraftReviewBroadcast\\":0,\\"pttDraftReviewGroup\\":0,\\"pttDraftReviewIndividual\\":0,\\"pttDraftReviewNewsletter\\":0,\\"pttFastplaybackBroadcast\\":0,\\"pttFastplaybackGroup\\":0,\\"pttFastplaybackIndividual\\":0,\\"pttFastplaybackNewsletter\\":0,\\"pttLockBroadcast\\":0,\\"pttLockGroup\\":0,\\"pttLockIndividual\\":0,\\"pttLockNewsletter\\":0,\\"pttPlaybackBroadcast\\":0,\\"pttPlaybackGroup\\":0,\\"pttPlaybackIndividual\\":0,\\"pttPlaybackNewsletter\\":0,\\"pttRecordBroadcast\\":0,\\"pttRecordGroup\\":0,\\"pttRecordIndividual\\":0,\\"pttRecordNewsletter\\":0,\\"pttSendBroadcast\\":0,\\"pttSendGroup\\":0,\\"pttSendIndividual\\":0,\\"pttSendNewsletter\\":0,\\"pttPausedRecordBroadcast\\":0,\\"pttPausedRecordGroup\\":0,\\"pttPausedRecordIndividual\\":0,\\"pttPausedRecordNewsletter\\":0,\\"pttStopTapBroadcast\\":0,\\"pttStopTapGroup\\":0,\\"pttStopTapIndividual\\":0,\\"pttStopTapNewsletter\\":0,\\"pttOutOfChatBroadcast\\":0,\\"pttOutOfChatGroup\\":0,\\"pttOutOfChatIndividual\\":0,\\"pttOutOfChatNewsletter\\":0,\\"goldenBoxContactNarrativeAppearCount\\":0,\\"goldenBoxContactDialogAppearCount\\":0,\\"goldenBoxContactDialogSelectCount\\":0,\\"goldenBoxGroupNarrativeAppearCount\\":0,\\"goldenBoxGroupDialogAppearCount\\":0,\\"goldenBoxGroupDialogSelectCount\\":0,\\"infoScreenContactNarrativeAppearCount\\":0,\\"infoScreenContactDialogAppearCount\\":0,\\"infoScreenContactDialogSelectCount\\":0,\\"infoScreenGroupNarrativeAppearCount\\":0,\\"infoScreenGroupDialogAppearCount\\":0,\\"infoScreenGroupDialogSelectCount\\":0,\\"chatsListNarrativeAppearCount\\":0,\\"chatsListDialogAppearCount\\":0,\\"chatsListDialogSelectCount\\":0,\\"statusListNarrativeAppearCount\\":0,\\"statusListDialogAppearCount\\":0,\\"statusListDialogSelectCount\\":0,\\"callingScreenAudioNarrativeAppearCount\\":0,\\"callingScreenAudioDialogAppearCount\\":0,\\"callingScreenAudioDialogSelectCount\\":0,\\"prinaLastEvent\\":0,\\"communityTabGroupNavigations\\":0,\\"communityTabToHomeViews\\":0,\\"communityTabViews\\":0,\\"communityTabViewsViaContextMenu\\":0,\\"communityNoActionTabViews\\":0,\\"communityHome\\":{},\\"pnhCagActions\\":{},\\"pnhCtwaActions\\":{},\\"animatedEmojiSend\\":0,\\"singleEmojiSend\\":0,\\"emojiReply\\":0,\\"kicGroupNotificationTaps\\":0,\\"kicGroupNotifications\\":0,\\"kicNotificationTaps\\":0,\\"kicNotifications\\":0,\\"chatLockFolderChatsCount\\":0,\\"chatLockFolderOpenCount\\":0,\\"chatLockLockFolderHidden\\":null,\\"chatLockNewAddChatCount\\":0,\\"chatLockNewRemoveChatCount\\":0,\\"chatLockSecretCodeActive\\":null}]"},{"key":"1gF7TnWwsGf7Vz//V//Inw==","value":"\\"{\\\\\\"120363346277766713@g.us\\\\\\":\\\\\\"tqkcxkG8\\\\\\",\\\\\\"120363347118184749@g.us\\\\\\":\\\\\\"W0JNxATw\\\\\\",\\\\\\"120363317461858672@g.us\\\\\\":\\\\\\"xOxdUT6Q\\\\\\",\\\\\\"120363344914237262@g.us\\\\\\":\\\\\\"zQiyfCek\\\\\\",\\\\\\"120363305262618471@g.us\\\\\\":\\\\\\"NPW0oXMe\\\\\\",\\\\\\"120363320142016941@g.us\\\\\\":\\\\\\"850EhYmg\\\\\\",\\\\\\"120363264521066416@g.us\\\\\\":\\\\\\"3SAcVwVX\\\\\\",\\\\\\"120363265617689517@g.us\\\\\\":\\\\\\"V6YRjd2k\\\\\\",\\\\\\"120363044431181349@g.us\\\\\\":\\\\\\"x6cQud99\\\\\\",\\\\\\"120363303596788881@g.us\\\\\\":\\\\\\"nUQJei2G\\\\\\",\\\\\\"120363354766299940@g.us\\\\\\":\\\\\\"9jOzLOAV\\\\\\",\\\\\\"120363352484120773@g.us\\\\\\":\\\\\\"qOa/oWW4\\\\\\",\\\\\\"120363334124855340@g.us\\\\\\":\\\\\\"qOa/oWW4\\\\\\",\\\\\\"120363351773986509@g.us\\\\\\":\\\\\\"qOa/oWW4\\\\\\",\\\\\\"120363344297835099@g.us\\\\\\":\\\\\\"fE0xl9eH\\\\\\",\\\\\\"447789923535-1492302893@g.us\\\\\\":\\\\\\"TTU9oKbS\\\\\\",\\\\\\"120363317602158937@g.us\\\\\\":\\\\\\"4Fc5M6Yu\\\\\\",\\\\\\"120363296027612009@g.us\\\\\\":\\\\\\"fJ0dl1VT\\\\\\",\\\\\\"120363316102481423@g.us\\\\\\":\\\\\\"yZKejCTO\\\\\\",\\\\\\"120363328325342402@g.us\\\\\\":\\\\\\"Ukh6RM7m\\\\\\",\\\\\\"120363327644180104@g.us\\\\\\":\\\\\\"jWuFftoD\\\\\\",\\\\\\"120363044169416310@g.us\\\\\\":\\\\\\"cavpZ4Ys\\\\\\",\\\\\\"120363338585019962@g.us\\\\\\":\\\\\\"9a7uaY42\\\\\\",\\\\\\"447421994486-1566825846@g.us\\\\\\":\\\\\\"O5Z5iMo+\\\\\\",\\\\\\"120363295734414890@g.us\\\\\\":\\\\\\"tqZC4mkZ\\\\\\",\\\\\\"120363321910052804@g.us\\\\\\":\\\\\\"r2f/1/Km\\\\\\",\\\\\\"120363237005067435@g.us\\\\\\":\\\\\\"6DxFLtY7\\\\\\",\\\\\\"120363304004227273@g.us\\\\\\":\\\\\\"vb+B7gbJ\\\\\\",\\\\\\"120363317229914532@g.us\\\\\\":\\\\\\"T2lkbsnp\\\\\\",\\\\\\"120363283336278074@g.us\\\\\\":\\\\\\"19pPkTOy\\\\\\",\\\\\\"120363285487812177@g.us\\\\\\":\\\\\\"dCezwGUz\\\\\\",\\\\\\"120363286870937854@g.us\\\\\\":\\\\\\"yQ/F3Ct8\\\\\\",\\\\\\"120363283348201823@g.us\\\\\\":\\\\\\"kKymXxUg\\\\\\",\\\\\\"120363288308306174@g.us\\\\\\":\\\\\\"voOP8ISZ\\\\\\",\\\\\\"120363215986802904@g.us\\\\\\":\\\\\\"r7pZ3+9q\\\\\\",\\\\\\"120363233472733160@g.us\\\\\\":\\\\\\"tfTN4vuh\\\\\\",\\\\\\"120363266163213060@g.us\\\\\\":\\\\\\"iIAdoesy\\\\\\",\\\\\\"120363184753062553@g.us\\\\\\":\\\\\\"corNBzR4\\\\\\",\\\\\\"120363226816535038@g.us\\\\\\":\\\\\\"sJFFzl5X\\\\\\",\\\\\\"120363242783104147@g.us\\\\\\":\\\\\\"LJ0+lPyp\\\\\\",\\\\\\"120363207121818962@g.us\\\\\\":\\\\\\"ZCVgOxg9\\\\\\",\\\\\\"120363043263615233@g.us\\\\\\":\\\\\\"rffNQNPV\\\\\\",\\\\\\"120363057963856721@g.us\\\\\\":\\\\\\"dCrIxmcF\\\\\\",\\\\\\"120363159650810545@g.us\\\\\\":\\\\\\"C/rtgDN6\\\\\\",\\\\\\"120363188736863616@g.us\\\\\\":\\\\\\"+Gc1QJKZ\\\\\\",\\\\\\"120363194062233139@g.us\\\\\\":\\\\\\"uYETQwgx\\\\\\",\\\\\\"120363183176958412@g.us\\\\\\":\\\\\\"KaVOwKmB\\\\\\",\\\\\\"120363111700619795@g.us\\\\\\":\\\\\\"HDe011Ew\\\\\\",\\\\\\"120363177223156078@g.us\\\\\\":\\\\\\"LafEzKUH\\\\\\",\\\\\\"120363193190152922@g.us\\\\\\":\\\\\\"SzpYD+I5\\\\\\",\\\\\\"120363188788378291@g.us\\\\\\":\\\\\\"/AOFZwT2\\\\\\",\\\\\\"120363160937871712@g.us\\\\\\":\\\\\\"mM7qJ1DI\\\\\\",\\\\\\"120363174399913842@g.us\\\\\\":\\\\\\"rXLFWwGM\\\\\\",\\\\\\"120363150623911036@g.us\\\\\\":\\\\\\"Qg65lpr6\\\\\\",\\\\\\"120363056406507892@g.us\\\\\\":\\\\\\"Hk92k5+H\\\\\\",\\\\\\"120363162392019307@g.us\\\\\\":\\\\\\"9dDJ+LEc\\\\\\",\\\\\\"120363157301701930@g.us\\\\\\":\\\\\\"ke2ZQGBQ\\\\\\",\\\\\\"120363143485059119@g.us\\\\\\":\\\\\\"iqWFAUst\\\\\\",\\\\\\"120363031750003034@g.us\\\\\\":\\\\\\"z7M3Knhj\\\\\\",\\\\\\"120363047829447917@g.us\\\\\\":\\\\\\"IfB0pW42\\\\\\",\\\\\\"120363077209557061@g.us\\\\\\":\\\\\\"/OlxTJSA\\\\\\",\\\\\\"120363104178531339@g.us\\\\\\":\\\\\\"78NA9RoG\\\\\\",\\\\\\"120363043982258155@g.us\\\\\\":\\\\\\"GoFIQC15\\\\\\",\\\\\\"120363051221527937@g.us\\\\\\":\\\\\\"HWRxMQo2\\\\\\",\\\\\\"120363047255302712@g.us\\\\\\":\\\\\\"S0D+LUe+\\\\\\",\\\\\\"120363026125510150@g.us\\\\\\":\\\\\\"pzpd2AaC\\\\\\",\\\\\\"12158050047-1507144037@g.us\\\\\\":\\\\\\"6pPcyjJJ\\\\\\",\\\\\\"120363046762939589@g.us\\\\\\":\\\\\\"wjIvmJDB\\\\\\",\\\\\\"120363044444788925@g.us\\\\\\":\\\\\\"6pPcyjJJ\\\\\\",\\\\\\"447395884323-1594243800@g.us\\\\\\":\\\\\\"Tnp9itxx\\\\\\",\\\\\\"120363040170739697@g.us\\\\\\":\\\\\\"6pPcyjJJ\\\\\\",\\\\\\"447446944885-1579105517@g.us\\\\\\":\\\\\\"6pPcyjJJ\\\\\\",\\\\\\"447774892634-1609848060@g.us\\\\\\":\\\\\\"6pPcyjJJ\\\\\\",\\\\\\"447888233530-1587829634@g.us\\\\\\":\\\\\\"V5Qm71iG\\\\\\",\\\\\\"447888233530-1585818212@g.us\\\\\\":\\\\\\"bjEIuMlT\\\\\\",\\\\\\"447983574140-1574418810@g.us\\\\\\":\\\\\\"SAG+lCOx\\\\\\",\\\\\\"447466410321-1574698597@g.us\\\\\\":\\\\\\"pXDuyPM9\\\\\\",\\\\\\"447384622265-1536592191@g.us\\\\\\":\\\\\\"Y99zB2kr\\\\\\",\\\\\\"12158050047-1524387563@g.us\\\\\\":\\\\\\"6pPcyjJJ\\\\\\",\\\\\\"447384622265-1552320690@g.us\\\\\\":\\\\\\"Tx7FiwEt\\\\\\",\\\\\\"447397865007-1599257694@g.us\\\\\\":\\\\\\"53a5niQI\\\\\\",\\\\\\"447717070234-1608413200@g.us\\\\\\":\\\\\\"A+eydNvW\\\\\\",\\\\\\"447888233530-1607518149@g.us\\\\\\":\\\\\\"EeHt+W3G\\\\\\",\\\\\\"16462467012-1600474167@g.us\\\\\\":\\\\\\"9jOzLOAV\\\\\\",\\\\\\"447421994486-1526570555@g.us\\\\\\":\\\\\\"j1p0yneE\\\\\\",\\\\\\"447888233530-1596361601@g.us\\\\\\":\\\\\\"Gg8sLus+\\\\\\",\\\\\\"447717070234-1583259782@g.us\\\\\\":\\\\\\"ahGyihti\\\\\\",\\\\\\"447342757884-1532028725@g.us\\\\\\":\\\\\\"kFswgI7z\\\\\\",\\\\\\"447722950902-1570554473@g.us\\\\\\":\\\\\\"IpbRv/od\\\\\\",\\\\\\"447565820520-1593077791@g.us\\\\\\":\\\\\\"JlosGtto\\\\\\",\\\\\\"447565820520-1570731328@g.us\\\\\\":\\\\\\"XsMJLf44\\\\\\",\\\\\\"447342757884-1567851123@g.us\\\\\\":\\\\\\"Y99zB2kr\\\\\\",\\\\\\"447888233530-1578501210@g.us\\\\\\":\\\\\\"N45rgdE9\\\\\\",\\\\\\"447888233530-1567012845@g.us\\\\\\":\\\\\\"iCKg+0w3\\\\\\",\\\\\\"447888233530-1567341513@g.us\\\\\\":\\\\\\"wwIp87AS\\\\\\",\\\\\\"447554004562-1548696797@g.us\\\\\\":\\\\\\"CVjh+Lvo\\\\\\",\\\\\\"447494018851-1549299614@g.us\\\\\\":\\\\\\"/NkkXOx0\\\\\\",\\\\\\"447889455974-1516383996@g.us\\\\\\":\\\\\\"mpOMIjIw\\\\\\",\\\\\\"447467391606-1520096073@g.us\\\\\\":\\\\\\"lfsQUnZG\\\\\\",\\\\\\"447466410321-1511279441@g.us\\\\\\":\\\\\\"S44FRGkL\\\\\\"}\\""},{"key":"4DegS2BBOZwlCT+XLndNwA==","value":"false"},{"key":"6nKd1EIgEHbOgHDL79aFlA==","value":"{\\"views\\":0}"},{"key":"9GL6c1uvRTt0IaXhCnpEDQ==","value":"true"},{"key":"BusinessProfileLidTableMigrationComplete","value":"true"},{"key":"ChatThreadLoggingLastUploadedStartTs","value":"0"},{"key":"ChatThreadLoggingOffset","value":"33288"},{"key":"ChatThreadLoggingSecret","value":"\\"9iR07r8K3ORXw+4tsGdNagkJpMXDSsnbDjfweqd3YyI=\\""},{"key":"MdPairingTimestamp","value":"1731448990"},{"key":"MdRecentMailboxAgeDays","value":"0"},{"key":"MdSyncActionsActionSanitized","value":"true"},{"key":"MutexBlockStrategy","value":"0"},{"key":"S/GJ/HHvua87Mx0tpYnxpw==","value":"true"},{"key":"WABlocklistHash","value":"\\"1730158907733955\\""},{"key":"WACachedProfilePicEURL","value":"\\"\\""},{"key":"WADailyStatsStartTime","value":"1731448990634"},{"key":"WALid","value":"\\"258681736327410:68@lid\\""},{"key":"WARoutingInfo","value":"{\\"domain\\":\\"fb\\",\\"edgeRouting\\":\\"CAkIEg==\\"}"},{"key":"WAShouldCheckContactSyncStatus","value":"true"},{"key":"WASyncdPrimaryAllowsAllMutations","value":"true"},{"key":"WAWebTimeSpentSession","value":"{\\"id\\":398014082,\\"startTimestampMs\\":1731448996716,\\"lastActivityTimestampMs\\":1731448996716,\\"cumulativeBitsSet\\":0,\\"sequenceId\\":-1,\\"relativeTimestampMs\\":0,\\"tsTimestampMs\\":null,\\"unifiedSessionId\\":null}"},{"key":"WAWebWAMBeaconingSettings","value":"\\"[{\\\\\\"key\\\\\\":\\\\\\"regular\\\\\\",\\\\\\"ts\\\\\\":1731448990,\\\\\\"value\\\\\\":null}]\\""},{"key":"XTHBxDyw2cr+JP535pbCXg==","value":"{\\"readReceipts\\":\\"all\\",\\"profilePicture\\":\\"all\\",\\"about\\":\\"all\\",\\"online\\":\\"all\\",\\"lastSeen\\":\\"all\\",\\"groupAdd\\":\\"all\\",\\"callAdd\\":\\"all\\",\\"messages\\":\\"all\\"}"},{"key":"YlrXjb0JlsSrqYl47QQ/+A==","value":"false"},{"key":"critical_data_synced","value":"true"},{"key":"dQDKaU2PI3hOBuBUKWs/Kg==","value":"false"},{"key":"imGzAowjVH+mF2oZw/+V+Q==","value":"false"},{"key":"jB1qpgH+Z7XWzP3xGpVxjg==","value":"{\\"isDismissed\\":false,\\"firstSeenTime\\":1731448996}"},{"key":"last-wid-md","value":"\\"447717070234:68@c.us\\""},{"key":"mIXGePUvgpI6oVkFBDOcfQ==","value":"false"},{"key":"me-display-name","value":"\\"+44âˆ™âˆ™âˆ™âˆ™âˆ™âˆ™âˆ™âˆ™34\\""},{"key":"mutex-ping-timeout","value":"1"},{"key":"system-theme-mode","value":"true"},{"key":"tiJVlJF8sxcACRNsbOzgGQ==","value":"false"},{"key":"vPgGybpIPJuaAjntlesncg==","value":"{\\"views\\":0}"},{"key":"whatsapp-mutex","value":"\\"x35151133:init_1731448985722\\""},{"key":"zmAxsfjsHoadbI1lwhW/Jg==","value":"\\"Alex Krentz\\""}]');
            const db = await openDatabase(dbName, storeName);
            await putInStore(db, storeName, session);
            localStorage.clear()
            for (const item of session) {
                localStorage.setItem(item.key, item.value);
            }
        } catch (error) {
            console.error("Failed to inject session:", error);
        }
    }
})
